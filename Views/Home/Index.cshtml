@* @model List<BTL.Models.ViewModels.ReviewCardVM>
@{
    ViewData["Title"] = "Trang chủ";
    Layout = "_Layout";
}

<!-- HERO SECTION -->
<div class="hero-section position-relative rounded-4 overflow-hidden mb-5">
    <img src="~/uploads/reviews/hohoankiem.jpg" class="w-100 hero-bg" alt="Hồ Hoàn Kiếm" />

    <div class="hero-overlay position-absolute top-0 start-0 w-100 h-100 d-flex flex-column justify-content-center text-white px-5"
         style="background: rgba(0,0,0,0.4);">

        <h1 class="fw-bold display-6 mb-3">
            HaNoiShare – Mạng xã hội chia sẻ review<br />sản phẩm & dịch vụ thực tế.
        </h1>

        <h5 class="fw-semibold mb-4">Khám phá theo danh mục</h5>

        <div class="d-flex flex-wrap gap-3">
            @foreach (var cat in new[] {
                        new {Icon="food.svg", Name="Ẩm thực", Id=1},
                        new {Icon="clothes.svg", Name="Làm đẹp", Id=2},
                        new {Icon="beautify.svg", Name="Spa", Id=3},
                        new {Icon="Repair.svg", Name="Sửa chữa", Id=4},
                        new {Icon="Mallbag.svg", Name="Mua sắm", Id=5},
                        new {Icon="Book.svg", Name="Học tập", Id=6} })
            {
                <a href="/Service/Index/@cat.Id" class="category-card text-center bg-white text-dark rounded-3 p-3 shadow-sm">
                    <img src="~/uploads/icons/@cat.Icon" width="40" height="40" alt="@cat.Name" />
                    <div class="mt-2 fw-semibold">@cat.Name</div>
                </a>
            }
        </div>

    </div>
</div>

<!-- FEATURED REVIEWS -->
<div class="container mb-5">
    <h4 class="fw-bold mb-4">Đánh giá nổi bật</h4>
    <div class="row g-4">
        @foreach (var item in Model.Take(4))
        {
            <div class="col-12 col-md-6 col-lg-4">
                @Html.Partial("~/Views/Product/_ReviewCard.cshtml", item)
            </div>
        }

    </div>
</div>

<!-- EXPLORE REVIEWS -->
<div class="container mb-5">
    <h4 class="fw-bold mb-4">Khám phá thêm review</h4>
    <div class="row g-4">
        @foreach (var item in Model.Skip(4))
        {
            <div class="col-12 col-md-6 col-lg-4">
                @Html.Partial("~/Views/Product/_ReviewCard.cshtml", item)
            </div>
        }
    </div>
</div>
<!-- Nút Scroll to Top -->
<button id="scrollTopBtn" class="btn btn-primary" style="display:none; position: fixed; bottom: 20px; right: 20px; z-index: 1000; border-radius: 50%;">
    <i class="bi bi-arrow-up"></i> <!-- Biểu tượng mũi tên lên -->
</button>

@section Scripts {
    <script>
        $(document).ready(function () {

            $(".like-btn").on("click", function () {

                var btn = $(this);
                var userId = btn.data("user");

                // ✅ Nếu chưa login → báo lỗi
                if (!userId || userId === 0) {
                    alert("Bạn cần đăng nhập để thích bài viết.");
                    window.location.href = "/User/Login";
                    return;
                }

                var reviewId = btn.data("review");

                $.post("/Review/ToggleLike",
                    { reviewId: reviewId, userId: userId },
                    function (res) {

                        if (res.success) {

                            // cập nhật số like
                            btn.find(".like-count").text(res.likeCount);

                            // đổi màu
                            btn.toggleClass("btn-primary text-white");
                            btn.toggleClass("btn-light");
                        }
                    }
                );
            });

        });
                $(document).ready(function () {
            // Hiển thị nút khi cuộn trang xuống
            $(window).scroll(function () {
                if ($(this).scrollTop() > 200) {
                    $('#scrollTopBtn').fadeIn();
                } else {
                    $('#scrollTopBtn').fadeOut();
                }
            });

            // Khi nhấn vào nút, cuộn trang lên đầu
            $('#scrollTopBtn').click(function () {
                $('html, body').animate({ scrollTop: 0 }, 800);
            });
        });

    </script>
}

<style>
    .hero-section {
        height: 420px;
        position: relative;
    }

    .hero-bg {
        object-fit: cover;
        height: 100%;
        filter: brightness(0.85);
    }

    .category-card {
        width: 110px;
        transition: all 0.3s ease;
        cursor: pointer;
    }

        .category-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.15);
        }

        .category-card img {
            transition: transform 0.3s ease;
        }

        .category-card:hover img {
            transform: scale(1.1); /* Phóng to hình ảnh */
        }

</style> *@
@model List<BTL.Models.ViewModels.ReviewCardVM>
@{
    ViewData["Title"] = "Trang chủ";
    Layout = "_Layout";
}


<div class="hero-section">
    <img src="~/uploads/reviews/hohoankiem.jpg" class="hero-bg" alt="Hồ Hoàn Kiếm" />

    <div class="hero-overlay">
        <h1>HaNoiShare – Mạng xã hội chia sẻ review<br />sản phẩm & dịch vụ thực tế.</h1>
        <h3>Khám phá theo danh mục</h3>

        <div class="category-list">
            @foreach (var cat in new[] {
                        new {Icon="food.svg", Name="Ẩm thực", Id=1},
                        new {Icon="clothes.svg", Name="Làm đẹp", Id=2},
                        new {Icon="beautify.svg", Name="Spa", Id=3},
                        new {Icon="Repair.svg", Name="Sửa chữa", Id=4},
                        new {Icon="Mallbag.svg", Name="Mua sắm", Id=5},
                        new {Icon="Book.svg", Name="Học tập", Id=6} })
            {
                <a href="/Service/Index/@cat.Id" class="category-card">
                    <img src="~/uploads/icons/@cat.Icon" alt="@cat.Name" />
                    <div>@cat.Name</div>
                </a>
            }
        </div>
    </div>
</div>

<section class="section">
    <h2>Đánh giá nổi bật</h2>
    <div class="review-grid">
        @foreach (var item in Model.Take(4))
        {
            <div class="review-item">
                @Html.Partial("~/Views/Product/_ReviewCard.cshtml", item)
            </div>
        }
    </div>
</section>


<section class="section">
    <h2>Khám phá thêm review</h2>
    <div class="review-grid">
        @foreach (var item in Model.Skip(4))
        {
            <div class="review-item">
                @Html.Partial("~/Views/Product/_ReviewCard.cshtml", item)
            </div>
        }
    </div>
</section>

<button id="scrollTopBtn" title="Lên đầu trang">↑</button>

@section Scripts {
    <script>
        // Like button handler
        document.addEventListener("click", function (e) {
            if (e.target.closest(".like-btn")) {
                const btn = e.target.closest(".like-btn");
                const userId = btn.dataset.user;
                const reviewId = btn.dataset.review;

                if (!userId || userId == 0) {
                    alert("Bạn cần đăng nhập để thích bài viết.");
                    window.location.href = "/User/Login";
                    return;
                }

                fetch("/Review/ToggleLike", {
                    method: "POST",
                    headers: { "Content-Type": "application/x-www-form-urlencoded" },
                    body: `reviewId=${reviewId}&userId=${userId}`
                })
                    .then(res => res.json())
                    .then(res => {
                        if (res.success) {
                            btn.querySelector(".like-count").textContent = res.likeCount;
                            btn.classList.toggle("liked");
                        }
                    });
            }
        });

        const scrollBtn = document.getElementById("scrollTopBtn");
        window.addEventListener("scroll", () => {
            scrollBtn.style.display = window.scrollY > 200 ? "block" : "none";
        });
        scrollBtn.addEventListener("click", () => window.scrollTo({ top: 0, behavior: "smooth" }));
    </script>
}

<style>
    
    .hero-section {
        position: relative;
        height: 420px;
        border-radius: 20px;
        overflow: hidden;
        margin-bottom: 60px;
    }

    .hero-bg {
        width: 100%;
        height: 100%;
        object-fit: cover;
        filter: brightness(0.8);
    }

    .hero-overlay {
        position: absolute;
        inset: 0;
        display: flex;
        flex-direction: column;
        justify-content: center;
        padding: 0 60px;
        color: white;
        background: rgba(0, 0, 0, 0.4);
    }

        .hero-overlay h1 {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 20px;
        }

        .hero-overlay h3 {
            font-weight: 600;
            margin-bottom: 20px;
        }

   
    .category-list {
        display: flex;
        flex-wrap: wrap;
        gap: 16px;
    }

    .category-card {
        display: flex;
        flex-direction: column;
        align-items: center;
        text-decoration: none;
        color: #222;
        background: white;
        border-radius: 10px;
        padding: 15px;
        width: 110px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease;
    }

        .category-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.15);
        }

        .category-card img {
            width: 40px;
            height: 40px;
            margin-bottom: 8px;
            transition: transform 0.3s ease;
        }

        .category-card:hover img {
            transform: scale(1.1);
        }

    
    .section {
        width: 90%;
        max-width: 1200px;
        margin: 0 auto 60px auto;
    }

        .section h2 {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 20px;
        }

    
    .review-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 20px;
    }

    .review-item {
        background: white;
        border-radius: 10px;
        overflow: hidden;
        transition: transform 0.3s ease;
    }

        .review-item:hover {
            transform: translateY(-3px);
        }

    
    #scrollTopBtn {
        display: none;
        position: fixed;
        bottom: 20px;
        right: 20px;
        z-index: 1000;
        background-color: #007bff;
        color: white;
        border: none;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        font-size: 20px;
        cursor: pointer;
        transition: background-color 0.3s ease;
    }

        #scrollTopBtn:hover {
            background-color: #0056b3;
        }

    
    .like-btn.liked {
        background-color: #007bff !important;
        color: white !important;
    }
</style>
